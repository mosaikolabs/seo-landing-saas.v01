---
// src/layouts/Layout.astro
import '../styles/global.css';
import Header from '../components/layout/Header.astro';
import Footer from '../components/layout/Footer.astro';

interface Props {
  title: string;
  description?: string;
  canonicalUrl?: string;
  noIndex?: boolean;
  noFollow?: boolean;
  ogImage?: string;
  ogType?: string;
  twitterCard?: string;
  structuredData?: object;
}

const { 
  title, 
  description = 'Aumente sus ventas con nuestro servicio de SEO especializado para joyerías. Obtenga más clientes calificados y aumente su visibilidad en línea.', 
  canonicalUrl,
  noIndex = false,
  noFollow = false,
  ogImage = '/images/og-image.jpg',  // Ahora en /public/images/og-image.jpg
  ogType = 'website',
  twitterCard = 'summary_large_image',
  structuredData
} = Astro.props;

// Construir la URL canónica
const siteUrl = 'https://joyerias-seo.com';
const canonical = canonicalUrl ? new URL(canonicalUrl, siteUrl).toString() : new URL(Astro.url.pathname, siteUrl).toString();
const pageTitle = `${title} | SEO para Joyerías`;

// Generar meta robots
const robots = [];
if (noIndex) robots.push('noindex');
if (noFollow) robots.push('nofollow');
const robotsContent = robots.length > 0 ? robots.join(', ') : 'index, follow';

// Datos estructurados por defecto (schema.org)
const defaultStructuredData = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "SEO para Joyerías",
  "url": siteUrl,
  "potentialAction": {
    "@type": "SearchAction",
    "target": `${siteUrl}/buscar?q={search_term_string}`,
    "query-input": "required name=search_term_string"
  }
};

// Combinar datos estructurados personalizados con los predeterminados
const pageStructuredData = structuredData || defaultStructuredData;
---

<!DOCTYPE html>
<html 
  lang="es" 
  class="scroll-smooth"
  itemscope 
  itemtype="https://schema.org/WebPage"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <meta name="robots" content={robotsContent} />
    
    {/* Favicon y meta tags esenciales */}
    <link rel="icon" type="image/svg+xml" href="/images/favicon.svg" />
    <link rel="alternate icon" href="/images/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png" />
    <meta name="theme-color" content="#2563eb" />
    
    {/* Open Graph / Facebook */}
    <meta property="og:site_name" content="SEO para Joyerías" />
    <meta property="og:locale" content="es_ES" />
    <meta property="og:type" content={ogType} />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(ogImage, siteUrl).toString()} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:url" content={canonical} />
    
    {/* Twitter */}
    <meta name="twitter:card" content={twitterCard} />
    <meta name="twitter:title" content={pageTitle} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={new URL(ogImage, siteUrl).toString()} />
    <meta name="twitter:site" content="@joyeriaseo" />
    
    {/* Canonical URL */}
    <link rel="canonical" href={canonical} />
    
    {/* Preconnect a recursos externos */}
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossOrigin="anonymous" />
    <link 
      rel="preload" 
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700;800&display=swap" 
      as="style" 
      onLoad="this.onload=null;this.rel='stylesheet'"
    />
    <noscript>
      <link 
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700;800&display=swap" 
        rel="stylesheet"
      />
    </noscript>
    
    {/* Preload de recursos críticos */}
    <link rel="preload" href="/fonts/your-custom-font.woff2" as="font" type="font/woff2" crossOrigin="anonymous" />
    
    {/* Datos estructurados */}
    <script type="application/ld+json" set:html={JSON.stringify(pageStructuredData)} />
    
    {/* Título de la página */}
    <title>{pageTitle}</title>
    
    {/* Estilos críticos inline */}
    <style>
      /* Estilos críticos para renderizado inicial */
      @font-face {
        font-family: 'YourCustomFont';
        src: url('/fonts/your-custom-font.woff2') format('woff2');
        font-weight: 400;
        font-style: normal;
        font-display: swap;
      }
      
      /* Estilos para el modo oscuro */
      @media (prefers-color-scheme: dark) {
        :root {
          --color-bg: #111827;
          --color-text: #f3f4f6;
        }
      }
    </style>
  </head>
  <body class="min-h-screen flex flex-col bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100">
    {/* Skip to main content link - Mejora de accesibilidad */}
    <a 
      href="#main-content" 
      class="sr-only focus:not-sr-only focus:fixed focus:top-4 focus:left-4 focus:px-4 focus:py-2 focus:bg-primary-600 focus:text-white focus:z-50 focus:rounded focus:shadow-lg"
    >
      Saltar al contenido principal
    </a>
    
    <Header />
    
    <main id="main-content" class="flex-grow">
      <slot />
    </main>
    
    <Footer />
    
    <!-- Scripts -->
    <script>
      // Detectar si JavaScript está habilitado para mejorar la accesibilidad
      document.documentElement.classList.add('js');
      
      // Scripts de analítica (ejemplo con Google Analytics)
      if (import.meta.env.PROD) {
        // Aquí iría el código de Google Analytics
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-XXXXXXXXXX');
      }
    </script>
  </body>
</html>
